---
title: "Fullständig exempel-rapport"
format:
  html:
    css: ../template/styles/styles.css  
    toc: true
    toc-depth: 2
    toc-title: "Innehåll:"
    toc-location: right
execute:
  echo: false
  warning: false
  message: false
lang: sv
---

```{r}
#| label: setup
#| include: false

source("../R/functions/visualisering_interaktiva_funktioner.R")
library(tidyverse)
library(ggiraph)
library(downloadthis)
```

```{r}
#| label: data
#| include: false

# Data för linjediagram
data_tidsserie <- tibble(
  år = rep(2015:2024, 3),
  befolkning = c(
    1000 + cumsum(rnorm(10, 50, 10)),  # Region A
    800 + cumsum(rnorm(10, 40, 8)),    # Region B
    1200 + cumsum(rnorm(10, 60, 12))   # Region C
  ),
  region = rep(c("Region A", "Region B", "Region C"), each = 10)
)

# Data för stapeldiagram
data_kategorier <- tibble(
  kategori = c("Kategori 1", "Kategori 2", "Kategori 3", "Kategori 4"),
  värde = c(150, 230, 180, 200),
  andel = c(20.5, 31.4, 24.6, 27.3)
)
```

# Fullständig exempel-rapport

Denna rapport demonstrerar alla funktioner i Quarto-rapportmallen.

::: highlight-box
## Såhär använder du rapporten

-   **Interaktiva diagram:** Placera muspekaren över datapunkter för detaljerad information
-   **Ladda ner:** Använd menyn för att ladda ner diagram (PNG) eller data (Excel/CSV)
-   **Helskärm:** Förstora diagram för bättre visning
-   **Navigering:** Innehållsförteckningen är klickbar
:::

## Sammanfattning

Denna rapport visar:
- Interaktiva linjediagram med flera serier
- Stapeldiagram med tooltips
- Panel-tabset för olika vyer
- Highlight-boxes för viktig information
- Fördjupade analyser

## Befolkningsutveckling

### Jämförelse mellan regioner

Här jämför vi befolkningsutvecklingen i tre olika regioner.

```{r}
#| label: tidsserie-diagram

# Tooltip
tooltip_data <- data_tidsserie |>
  skapa_tooltip(
    gruppvars = c("år"),
    grupp_labels = c(år = "År"),
    data_vars = c("region", "befolkning"),
    data_labels = c(region = "", befolkning = "Befolkning"),
    data_format = c(region = "text", befolkning = "nummer")
  )

plot_data <- data_tidsserie |>
  left_join(tooltip_data, by = "år")

# Plot
plot <- plot_data |>
  ggplot(aes(x = år, y = befolkning, color = region)) +
  geom_line_interactive(
    aes(data_id = år, tooltip = tooltip_text),
    linewidth = 0.6
  ) +
  geom_point_interactive(
    aes(data_id = år, tooltip = tooltip_text),
    size = 2
  ) +
  scale_y_continuous(
    labels = scales::comma_format(big.mark = " ")
  ) +
  labs(
    title = "Befolkningsutveckling per region",
    subtitle = "År 2015-2024",
    x = "",
    y = "Antal invånare",
    color = "",
    caption = "Källa: Exempeldata"
  ) +
  theme_minimal() +
  theme(legend.position = "top")

skapa_interaktiv_plot(
  plot_objekt = plot,
  export_data = plot_data,
  kolumn_mappning = c("År" = "år", "Befolkning" = "befolkning", "Region" = "region"),
  output_namn = "jamforelse_regioner",
  hover_r = 3,
  hover_inv_opacity = 0.5
)
```

Region C har haft den starkaste tillväxten, medan Region B har haft den mest stabila utvecklingen.

## Fördelning per kategori

### Översikt

::: panel-tabset
### Antal

```{r}
#| label: stapel-antal

tooltip_data <- data_kategorier |>
  skapa_tooltip(
    gruppvars = c("kategori"),
    grupp_labels = c(kategori = "Kategori"),
    data_vars = c("värde"),
    data_labels = c(värde = "Antal"),
    data_format = c(värde = "nummer")
  )

plot_data <- data_kategorier |>
  left_join(tooltip_data, by = "kategori")

plot_antal <- plot_data |>
  ggplot(aes(x = reorder(kategori, värde), y = värde)) +
  geom_col_interactive(
    aes(data_id = kategori, tooltip = tooltip_text),
    fill = "#0076bc",
    alpha = 0.7
  ) +
  coord_flip() +
  labs(
    title = "Fördelning per kategori",
    subtitle = "Absoluta tal",
    x = "",
    y = "Antal",
    caption = "Källa: Exempeldata"
  ) +
  theme_minimal()

skapa_interaktiv_plot(
  plot_objekt = plot_antal,
  export_data = plot_data,
  kolumn_mappning = c("Kategori" = "kategori", "Antal" = "värde"),
  output_namn = "fordelning_antal",
  width = 8,
  height = 5
)
```

### Andel

```{r}
#| label: stapel-andel

tooltip_data <- data_kategorier |>
  skapa_tooltip(
    gruppvars = c("kategori"),
    grupp_labels = c(kategori = "Kategori"),
    data_vars = c("andel"),
    data_labels = c(andel = "Andel"),
    data_format = c(andel = "procent"),
    decimaler = 1
  )

plot_data <- data_kategorier |>
  left_join(tooltip_data, by = "kategori")

plot_andel <- plot_data |>
  ggplot(aes(x = reorder(kategori, andel), y = andel)) +
  geom_col_interactive(
    aes(data_id = kategori, tooltip = tooltip_text),
    fill = "#3F5664",
    alpha = 0.7
  ) +
  coord_flip() +
  scale_y_continuous(
    labels = function(x) paste0(x, "%")
  ) +
  labs(
    title = "Fördelning per kategori",
    subtitle = "Procentuell andel",
    x = "",
    y = "Andel (%)",
    caption = "Källa: Exempeldata"
  ) +
  theme_minimal()

skapa_interaktiv_plot(
  plot_objekt = plot_andel,
  export_data = plot_data,
  kolumn_mappning = c("Kategori" = "kategori", "Andel" = "andel"),
  output_namn = "fordelning_andel",
  width = 8,
  height = 5
)
```
:::

Kategori 2 står för den största andelen (31,4%), följt av Kategori 4 (27,3%).

## Detaljerad analys

### Trender över tid

Vi kan se flera intressanta mönster i utvecklingen:

1. **Region A** visar en stabil tillväxttakt
2. **Region B** har den mest förutsägbara utvecklingen
3. **Region C** har accelererat under senare år

::: highlight-box
### Viktigt att notera

Dessa siffror är exempeldata och ska inte användas för faktiska analyser. Kontakta statistikavdelningen för verklig data.
:::

### Metodbeskrivning

Data har samlats in från tre olika regioner över en tioårsperiod. Alla värden har normaliserats för jämförbarhet.

## Sammanfattning och slutsatser

Denna rapport har visat:

- **Befolkningsutveckling**: Positiv trend i alla regioner
- **Regionala skillnader**: Betydande variation mellan områden
- **Kategorier**: Jämn fördelning med vissa kategorier mer framträdande

### Nästa steg

1. Fördjupad analys av Region C:s tillväxt
2. Undersökning av faktorer bakom kategori-fördelning
3. Uppföljning av trender kommande år

## Ytterligare information

::: highlight-box
## Kontakt och resurser

**E-post:** statistisk.analys@stadshuset.goteborg.se

**Webb:** [Statistik och analys](https://goteborg.se/wps/portal/enhetssida/statistik-och-analys)

**Dokumentation:** Se README.md och funktioner_katalog.md för mer information
:::

---

*Rapport genererad: `r Sys.Date()`*

*Mall version: 1.0*
